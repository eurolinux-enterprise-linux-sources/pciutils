diff -up pciutils-3.1.4/lib/caps.c.capfree pciutils-3.1.4/lib/caps.c
--- pciutils-3.1.4/lib/caps.c.capfree	2009-08-10 16:28:53.000000000 +0200
+++ pciutils-3.1.4/lib/caps.c	2011-09-23 15:57:11.236525351 +0200
@@ -96,8 +96,8 @@ pci_free_caps(struct pci_dev *d)
 
   while (cap = d->first_cap)
     {
-      d->first_cap = cap;
-      pci_mfree(d);
+      d->first_cap = cap->next;
+      pci_mfree(cap);
     }
 }
 
